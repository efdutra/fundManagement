(function(e){function t(t){for(var s,n,d=t[0],o=t[1],c=t[2],l=0,p=[];l<d.length;l++)n=d[l],a[n]&&p.push(a[n][0]),a[n]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);u&&u(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],s=!0,d=1;d<r.length;d++){var o=r[d];0!==a[o]&&(s=!1)}s&&(i.splice(t--,1),e=n(n.s=r[0]))}return e}var s={},a={app:0},i=[];function n(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=s,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var d=window["webpackJsonp"]=window["webpackJsonp"]||[],o=d.push.bind(d);d.push=t,d=d.slice();for(var c=0;c<d.length;c++)t(d[c]);var u=o;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var s=r("64a9"),a=r.n(s);a.a},"56d7":function(e,t,r){"use strict";r.r(t);r("cadf"),r("551c"),r("f751"),r("097d");var s=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"d-flex align-content-stretch flex-wrap align-items-stretch",attrs:{id:"app"}},[r("card",{attrs:{idUser:"1"}}),r("card",{attrs:{idUser:"2"}}),r("card",{attrs:{idUser:"3"}}),r("card",{attrs:{idUser:"4"}}),r("card",{attrs:{idUser:"7"}}),r("card",{attrs:{idUser:"8"}})],1)},i=[],n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.users.length>0?r("div",{staticClass:"wrapper"},[r("header",[e.users.length>0?r("h1",[e._v(e._s(e.actualUser.name))]):e._e(),r("select",{directives:[{name:"model",rawName:"v-model",value:e.idUserProp,expression:"idUserProp"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.idUserProp=t.target.multiple?r:r[0]}}},e._l(e.users,function(t){return r("option",{key:t._id,domProps:{value:t._id}},[e._v(e._s(t.name))])}),0)]),"ind"==e.users.find(function(t){return t._id==(e.idUserProp||e.idUser)}).role?r("div",{attrs:{id:"create"}},[r("hr"),r("h2",[e._v("Criar Seed")]),r("form",{attrs:{action:""}},[r("label",{attrs:{for:"nome"}},[e._v("Nome:")]),r("input",{attrs:{name:"nome",type:"text",placeholder:"Digite aqui o nome do seed"},on:{input:function(t){return e.getName(t.target.value)}}}),r("br"),r("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"type"}],attrs:{type:"radio",id:"reais",name:"tipo",value:"money"},domProps:{checked:e._q(e.type,"money")},on:{change:function(t){e.type="money"}}}),r("label",{attrs:{for:"reais"}},[e._v("Reais (R$)")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"type"}],attrs:{type:"radio",id:"promo",name:"tipo",value:"points"},domProps:{checked:e._q(e.type,"points")},on:{change:function(t){e.type="points"}}}),r("label",{attrs:{for:"promo"}},[e._v("Pontos")]),r("br"),r("label",{attrs:{for:"valor"}},[e._v("Valor:")]),r("input",{attrs:{name:"valor",type:"number",placeholder:"Digite o valor"},on:{input:function(t){return e.getPrice(t.target.value)}}}),r("br"),r("button",{on:{click:e.createSeed}},[e._v("Criar")])])]):e._e(),Object.keys(e.actualUser).length>0?[Object.keys(e.actualUser.seeds).length>0&&e.seeds.length>0?r("div",{attrs:{id:"frac"}},[r("hr"),r("h2",[e._v("Fracionar Seed")]),r("form",{attrs:{action:""}},[r("label",{attrs:{for:"seed"}},[e._v("Seed:")]),r("select",{directives:[{name:"model",rawName:"v-model",value:e.fracIdCamp,expression:"fracIdCamp"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.fracIdCamp=t.target.multiple?r:r[0]}}},e._l(e.actualUser.seeds,function(t,s){return r("option",{key:s,domProps:{value:s}},[e._v(e._s(t.seed_name))])}),0),r("br"),r("label",{attrs:{for:"dest"}},[e._v("Destino:")]),r("select",{directives:[{name:"model",rawName:"v-model",value:e.fracIdUser,expression:"fracIdUser"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.fracIdUser=t.target.multiple?r:r[0]}}},e._l(e.users.filter(function(t){return t._id!=e.idUserProp&&t._id!=e.seeds.find(function(t){return t._id==e.fracIdCamp}).owner_id}),function(t){return r("option",{key:t._id,domProps:{value:t._id}},[e._v(e._s(t.name))])}),0),r("br"),r("label",{attrs:{for:"valor"}},[e._v("Valor:")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.fracValue,expression:"fracValue"}],attrs:{name:"valor",type:"number",placeholder:"Digite o valor",max:e.seeds.find(function(t){return t._id==e.fracIdCamp}).value-e.seeds.find(function(t){return t._id==e.fracIdCamp}).used},domProps:{value:e.fracValue},on:{input:function(t){t.target.composing||(e.fracValue=t.target.value)}}}),r("br"),r("button",{on:{click:e.fracSeed}},[e._v("Salvar")])])]):e._e(),Object.keys(e.actualUser.seeds).length>0&&e.seeds.length>0?r("div",{attrs:{id:"extrato"}},[r("hr"),r("h2",[e._v("Extrato")]),r("label",{attrs:{for:"seed"}},[e._v("Selecione o Seed:")]),r("select",{directives:[{name:"model",rawName:"v-model",value:e.frac,expression:"frac"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.frac=t.target.multiple?r:r[0]}}},e._l(e.actualUser.seeds,function(t,s){return r("option",{key:s,domProps:{value:s}},[e._v(e._s(t.seed_name))])}),0),e.actualUser.seeds[e.frac]?r("div",{staticClass:"results"},[e.actualUser._id==e.seeds.find(function(t){return t._id==e.fracIdCamp}).owner_id?r("div",{staticClass:"valores"},[r("h4",[e._v("Total do Seed:")]),r("span",[e._v(e._s(parseFloat(e.seeds.find(function(t){return t._id==e.frac}).value).toLocaleString("pt-BR","points"==e.actualUser.seeds[e.frac].seed_type?{}:{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2})))]),"points"==e.seeds.find(function(t){return t._id==e.frac}).type?r("span",[e._v(" Pontos")]):e._e()]):e._e(),r("div",{staticClass:"valores"},[r("h4",[e._v(e._s(e.actualUser._id==e.seeds.find(function(t){return t._id==e.fracIdCamp}).owner_id?"Parcial do Seed:":"Total do Seed:"))]),r("span",[e._v(e._s(e.actualUser.seeds[e.frac].seed_creator?parseFloat(e.actualUser.seeds[e.frac].seed_used).toLocaleString("pt-BR","points"==e.actualUser.seeds[e.frac].seed_type?{}:{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}):parseFloat(e.actualUser.seeds[e.frac].seed_funds).toLocaleString("pt-BR","points"==e.actualUser.seeds[e.frac].seed_type?{}:{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2})))]),"points"==e.actualUser.seeds[e.frac].seed_type?r("span",[e._v(" Pontos")]):e._e()])]):e._e()]):e._e()]:e._e()],2):e._e()},d=[],o=r("75fc"),c=(r("6b54"),r("7f7f"),r("55dd"),r("96cf"),r("3b8d")),u=(r("ac6a"),r("456d"),r("7514"),{name:"card",props:["idUser"],data:function(){return{apiKey:"?apiKey=LLKamk80CzsWhh1DYeLENAKd0-vPMjN_",seedUrl:"https://api.mlab.com/api/1/databases/gestao-valores/collections/seeds",userUrl:"https://api.mlab.com/api/1/databases/gestao-valores/collections/usuarios",idUserProp:"",seeds:[],users:[],actualUser:"",fracIdCamp:"",fracIdUser:"",fracValue:"",message:"",price:"",type:"",frac:""}},watch:{idUserProp:function(e){var t=this;this.actualUser=this.users.length>0?this.users.find(function(t){return t._id==e}):"",this.fracIdCamp=Object.keys(this.actualUser.seeds).length>0?Object.keys(this.actualUser.seeds)[0]:"Nenhuma campanha cadastrada";var r=this.seeds.find(function(e){return e._id==t.fracIdCamp})?this.seeds.find(function(e){return e._id==t.fracIdCamp}).owner_id:e;this.fracIdUser=this.users.filter(function(t){return t._id!=e&&t._id!=r})[0]._id,this.frac=Object.keys(this.actualUser.seeds).length>0?Object.keys(this.actualUser.seeds)[0]:"--",this.fracValue=""}},methods:{reloadAllCards:function(){console.log("call reloadAll"),this.$root.$emit("reloadCards")},loadValues:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,r=this,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:this.idUser,s.length>1&&void 0!==s[1]&&s[1],e.next=4,fetch(this.userUrl+this.apiKey).then(function(e){return e.json()}).then(function(e){var t=e.sort(function(e,t){return e._id-t._id});r.users=t});case 4:return e.next=6,fetch(this.seedUrl+this.apiKey).then(function(e){return e.json()}).then(function(e){var t=e.sort(function(e,t){return e._id-t._id});r.seeds=t});case 6:this.idUserProp=t,this.actualUser=this.users.find(function(e){return e._id==t}),this.users.forEach(function(e){e["seeds"]={},e.created_seeds.forEach(function(t){e["seeds"][t.seed_id]||(e["seeds"][t.seed_id]={seed_name:r.seeds.find(function(e){return e._id==t.seed_id}).campanha,seed_value:t.seed_value,seed_used:r.seeds.find(function(e){return e._id==t.seed_id}).used,seed_type:r.seeds.find(function(e){return e._id==t.seed_id}).type,seed_creator:!0,seed_sender:!1,seed_funds:0,seed_history:[]})}),e.participated_seeds.forEach(function(t){e["seeds"][t.participated_seeds_id]?(e["seeds"][t.participated_seeds_id]["seed_funds"]=parseFloat(e["seeds"][t.participated_seeds_id]["seed_funds"])+parseFloat(t.participated_seeds_value),e["seeds"][t.participated_seeds_id]["seed_history"].push({send_by:r.users.find(function(e){return e._id==t.participated_seeds_sender_id}).name,value:t.participated_seeds_value,date:t.participated_seeds_date||""})):e["seeds"][t.participated_seeds_id]={seed_name:r.seeds.find(function(e){return e._id==t.participated_seeds_id}).campanha,seed_value:r.seeds.find(function(e){return e._id==t.participated_seeds_id}).value,seed_used:r.seeds.find(function(e){return e._id==t.participated_seeds_id}).used,seed_type:r.seeds.find(function(e){return e._id==t.participated_seeds_id}).type,seed_owner_id:r.seeds.find(function(e){return e._id==t.participated_seeds_id}).owner_id,seed_creator:!1,seed_sender:!0,seed_funds:parseFloat(t.participated_seeds_value),seed_history:[{send_by:r.users.find(function(e){return e._id==t.participated_seeds_sender_id}).name,value:t.participated_seeds_value,date:t.participated_seeds_date||""}]}})}),this.fracIdCamp=this.actualUser.created_seeds.length>0?this.actualUser.created_seeds[0].seed_id:"Nenhuma campanha cadastrada",this.fracIdUser=this.users.filter(function(e){return e._id!=r.idUserProp})[0]._id,this.frac=Object.keys(this.actualUser.seeds).length>0?Object.keys(this.actualUser.seeds)[0]:"--",this.fracValue="";case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),init:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadValues();case 2:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getName:function(e){this.message=e},getPrice:function(e){this.price=e},getUniqueIds:function(e){var t=e,r=[];return[t].forEach(function(e){return function(t){return t.forEach(function(t){e[t.seed_id||t.participated_seeds_id]||(e[t.seed_id||t.participated_seeds_id]={},r.push(e[t.seed_id||t.participated_seeds_id])),Object.assign(e[t.seed_id||t.participated_seeds_id],t)})}}(Object.create(null))),r},createSeed:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var r,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch(this.seedUrl+this.apiKey,{method:"POST",body:JSON.stringify({_id:(Math.max.apply(null,this.seeds.map(function(e){return e._id}).length>0?this.seeds.map(function(e){return e._id}):[0])+1).toString(),campanha:this.message,type:this.type,value:this.price,used:"0",created_date:new Date,owner_id:this.idUserProp,cashout:!1,participated_users:[]}),headers:new Headers({"content-type":"application/json"})}).then(function(e){alert("gravou!"),console.log("gravou seed ==> ",e)});case 3:return r=this.users.find(function(e){return e._id==s.idUserProp}).created_seeds,r.push({seed_id:(Math.max.apply(null,this.seeds.map(function(e){return e._id}).length>0?this.seeds.map(function(e){return e._id}):[0])+1).toString(),seed_value:this.price}),e.next=7,fetch(this.userUrl+"/"+this.idUserProp+this.apiKey,{method:"PUT",body:JSON.stringify({$set:{created_seeds:Object(o["a"])(r)}}),headers:new Headers({"content-type":"application/json"})}).then(function(e){alert("gravou!"),console.log("gravou no usuário ==> ",e)});case 7:return e.next=9,this.reloadAllCards();case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),fracSeed:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var r,s,a,i,n,d,c=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.preventDefault(),r=this.seeds.find(function(e){return e._id==c.fracIdCamp}),s=r.participated_users.indexOf(this.fracIdUser)<0?[].concat(Object(o["a"])(r.participated_users),[this.fracIdUser]):Object(o["a"])(r.participated_users),a=parseFloat(r.used)+parseFloat(this.fracValue),i=this.users.find(function(e){return e._id==c.fracIdUser}).participated_seeds,n=this.actualUser.participated_seeds,d=this.actualUser.seeds[this.fracIdCamp].seed_creator?{participated_users:Object(o["a"])(s),used:a}:{participated_users:Object(o["a"])(s)},i.push({participated_seeds_id:this.fracIdCamp,participated_seeds_value:this.fracValue,participated_seeds_sender_id:this.idUserProp}),n.push({participated_seeds_id:this.fracIdCamp,participated_seeds_value:-1*this.fracValue,participated_seeds_sender_id:this.idUserProp}),e.next=7,fetch(this.seedUrl+"/"+this.fracIdCamp+this.apiKey,{method:"PUT",body:JSON.stringify({$set:d}),headers:new Headers({"content-type":"application/json"})}).then(function(e){alert("atualizou!"),console.log("atualizou o seed ==> ",e)});case 7:return e.next=9,fetch(this.userUrl+"/"+this.fracIdUser+this.apiKey,{method:"PUT",body:JSON.stringify({$set:{participated_seeds:Object(o["a"])(i)}}),headers:new Headers({"content-type":"application/json"})}).then(function(e){alert("atualizou!"),console.log("atualizou o usuário ==> ",e)});case 9:if(!this.actualUser.seeds[this.fracIdCamp].seed_sender){e.next=12;break}return e.next=12,fetch(this.userUrl+"/"+this.idUserProp+this.apiKey,{method:"PUT",body:JSON.stringify({$set:{participated_seeds:Object(o["a"])(n)}}),headers:new Headers({"content-type":"application/json"})}).then(function(e){alert("atualizou!"),console.log("atualizou o usuário ==> ",e)});case 12:return e.next=14,this.reloadAllCards();case 14:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){var e=this;this.$root.$on("reloadCards",Object(c["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log("call reloadTHIScard",e.idUserProp),t.next=3,e.loadValues(e.idUserProp,!0);case 3:case"end":return t.stop()}},t)}))),this.init()}}),l=u,p=(r("c73f"),r("2877")),f=Object(p["a"])(l,n,d,!1,null,"10373984",null),_=f.exports,h={name:"app",components:{card:_}},m=h,v=(r("034f"),Object(p["a"])(m,a,i,!1,null,null,null)),y=v.exports;s["a"].config.productionTip=!1,new s["a"]({render:function(e){return e(y)}}).$mount("#app")},"64a9":function(e,t,r){},"93e3":function(e,t,r){},c73f:function(e,t,r){"use strict";var s=r("93e3"),a=r.n(s);a.a}});
//# sourceMappingURL=app.239624d7.js.map